<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NDMD Logs</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>

<body>
    <div class="logs-page">
        <!-- Helper div to match CSS scope if needed, or app.js injects navbar outside -->
        <main style="padding: 20px;">
            <div class="glass-effect" style="border-radius: 16px; padding: 20px;">
                <header class="logs-header"
                    style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h1 class="login-title" style="margin: 0;">System Logs</h1>
                    <div style="font-size: 0.9rem; color: #a78bfa;">Auto-refreshing (5s)</div>
                </header>

                <div class="table-container">
                    <table class="logdevice">
                        <thead>
                            <tr>
                                <th>Time</th>
                                <th>Device ID</th>
                                <th>IP Address</th>
                                <th>Name</th>
                                <th>Status</th>
                                <th>Latency</th>
                            </tr>
                        </thead>
                        <tbody id="logs-body">
                            <tr>
                                <td colspan="6" style="text-align: center;">Loading logs...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <script src="js/app.js"></script>
    <script>
        const authHeader = { 'Authorization': `Bearer ${getToken()}`, 'Content-Type': 'application/json' };

        async function fetchLogs() {
            try {
                const res = await fetch(`${API_BASE_URL}/monitoring/status-logs`, { headers: authHeader });
                const data = await res.json();
                const logs = data.logs || [];

                const tbody = document.getElementById('logs-body');
                tbody.innerHTML = logs.map(log => `
                     <tr>
                        <td>${new Date(log.time).toLocaleString()}</td>
                        <td>${log.device_id}</td>
                        <td>${log.ip_address || 'N/A'}</td>
                        <td>${log.device_name}</td>
                        <td><span class="status-badge ${log.status}">${log.status}</span></td>
                        <td>${log.latency ? log.latency + ' ms' : 'N/A'}</td>
                     </tr>
                `).join('');
            } catch (e) { console.error(e); }
        }

        // Poll
        fetchLogs();
        setInterval(fetchLogs, 5000);
    </script>
</body>

</html>