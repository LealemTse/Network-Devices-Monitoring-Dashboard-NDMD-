<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NDMD Settings</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>

<body>
    <div class="settings">
        <main style="padding: 20px; display: flex; justify-content: center;">
            <div class="login-container glass-effect settings-config" style="margin-top: 40px; max-width: 600px;">
                <header style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
                    <i class="fas fa-cog" style="font-size: 2rem; color: #fff;"></i>
                    <h1 class="login-title" style="margin: 0; font-size: 1.8rem;">System Configuration</h1>
                </header>

                <form onsubmit="handleSave(event)" class="settings-form" style="width: 100%;">
                    <div class="form-group">
                        <label class="login-label">Ping Interval (ms)</label>
                        <input type="number" id="pingInterval" class="input futuristic-input" placeholder="3000">
                    </div>
                    <div class="form-group">
                        <label class="login-label">Ping Timeout (seconds)</label>
                        <input type="number" id="pingTimeout" class="input futuristic-input" placeholder="5">
                    </div>
                    <div class="form-group">
                        <label class="login-label">Retry Count</label>
                        <input type="number" id="retryCount" class="input futuristic-input" placeholder="3">
                    </div>

                    <button type="submit" class="futuristic-btn" style="width: 100%;">
                        <i class="fas fa-save"></i> Save Configuration
                    </button>
                </form>
            </div>
        </main>
    </div>

    <script src="js/app.js"></script>
    <script>
        const authHeader = { 'Authorization': `Bearer ${getToken()}`, 'Content-Type': 'application/json' };
        const CONFIG_URL = `${API_BASE_URL}/configs`;

        // Load Settings
        fetch(CONFIG_URL, { headers: authHeader })
            .then(res => res.json())
            .then(data => {
                document.getElementById('pingInterval').value = data.pingInterval || 3000;
                document.getElementById('pingTimeout').value = data.pingTimeout || 5;
                document.getElementById('retryCount').value = data.retryCount || 3;
            })
            .catch(e => console.log('Using defaults'));

        async function handleSave(e) {
            e.preventDefault();
            const data = {
                pingInterval: Number(document.getElementById('pingInterval').value),
                pingTimeout: Number(document.getElementById('pingTimeout').value),
                retryCount: Number(document.getElementById('retryCount').value)
            };

            try {
                const res = await fetch(CONFIG_URL, { method: 'PUT', headers: authHeader, body: JSON.stringify(data) });
                if (res.ok) showToast('Settings saved!');
                else throw new Error('Save failed');
            } catch (e) { showToast('Error saving settings', 'error'); }
        }
    </script>
</body>

</html>